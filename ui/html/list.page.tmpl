{{template "base" .}}
{{define "title"}}Games{{end}}
{{define "main"}}
{{if .UserGames}}
<style>
    #input-current-progress.active,
    #input-final-progress.active {
        width: 50px;
        display: inline;
        padding: 0.5em;
    }

    .hidden {
        display: none;
    }

    .button {
        cursor: pointer;
    }
</style>

<table>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Status</th>
        <th>Progress</th>
        <th></th>
    </tr>
    {{range .UserGames}}
    <tr>
        <td>{{.ID}}</td>
        <td>{{.Game.Name}}</td>
        <td>{{.Status}}</td>
        <td>
            <form action="/games/progress" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">

                <input type="text" id="input-current-progress" name="currentProgress" class="hidden" value="{{.Progress.Current}}">
                <span id="current-progress">{{.Progress.Current}}</span>
                /
                <input type="text" id="input-final-progress" name="finalProgress" class="hidden"value="{{.Progress.Final}}">
                <span id="final-progress">{{.Progress.Final}} </span>

                <span id="edit-button" class="button">âœŽ</span>
                <button type="submit" id="save-button" class="button hidden">ðŸ’¾</span>
            </form>
        </td>
        <td>
            <form action="/games/status" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">
                {{ if eq .Status "To Do" }}
                <button type="submit" name="status" value="In Progress"> In Progress </button>
                <button type="submit" name="status" value="Done"> Done </button>
                {{ else if eq .Status "In Progress"}}
                <button type="submit" name="status" value="To Do"> To Do </button>
                <button type="submit" name="status" value="Done"> Done </button>
                {{ else if eq .Status "Done"}}
                <button type="submit" name="status" value="To Do"> To Do </button>
                <button type="submit" name="status" value="In Progress"> In Progress </button>
                {{ end }}
            </form>
            <form action="/games/delete" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">
                <button type="submit" style="color: red"> Delete </button>
            </form>
        </td>
    </tr>
    {{end}}
</table>
{{else}}
<p>Currently there are no games.</p>
{{end}}
<a href="games/add">
    <input type="submit" value="+" style="float: right;"></button>
</a>
{{end}}

<script>
    const btn = document.getElementById('edit-button')
    btn.addEventListener('click', function () {
        document.getElementById('input-current-progress').classList.add('active');
        document.getElementById('input-current-progress').classList.remove('hidden');
        document.getElementById('input-final-progress').classList.add('active');
        document.getElementById('input-final-progress').classList.add('hidden');
        document.getElementById('save-button').classList.add('active');
        document.getElementById('save-button').classList.remove('hidden');

        document.getElementById('current-progress').classList.add('hidden');
        document.getElementById('final-progress').classList.add('hidden');
        document.getElementById('edit-button').classList.add('hidden');
    });
</script>
