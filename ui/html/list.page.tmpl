{{template "base" .}}
{{define "title"}}Games{{end}}
{{define "main"}}
{{if .UserGames}}
<style>
    #input-current-progress.active,
    #input-final-progress.active {
        width: 50px;
        display: inline;
        padding: 0.5em;
    }

    .hidden {
        display: none;
    }

    .button {
        cursor: pointer;
    }
</style>

<table>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Status</th>
        <th>Progress</th>
        <th></th>
    </tr>
    {{range $userGame := .UserGames}}
    <tr>
        <td>{{.ID}}</td>
        <td>{{.Game.Name}}</td>
        <td>
            <form action="/games/status" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">
                <span id="status-{{.ID}}" class="status">{{.Status}}</span>
                <select id="status-dropdown-{{.ID}}" name="status" class="hidden">
                    {{range $status := $.Statuses}}
                    <option value="{{$status}}" {{if eq $status $userGame.Status }}selected{{end}}>{{$status}}</option>
                    {{end}}
                </select>
                <span id="edit-status-button-{{.ID}}" class="button edit-status-button" data-game-id="{{.ID}}"
                    class="button">âœŽ</span>
                <button type="submit" id="save-status-button-{{.ID}}" class="button hidden">ðŸ’¾</button>
            </form>
        </td>
        <td>
            <form action="/games/progress" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">

                <input type="text" id="input-current-progress" name="currentProgress" class="hidden"
                    value="{{.Progress.Current}}">
                <span id="current-progress">{{.Progress.Current}}</span>
                /
                <input type="text" id="input-final-progress" name="finalProgress" class="hidden"
                    value="{{.Progress.Final}}">
                <span id="final-progress">{{.Progress.Final}} </span>

                <span id="edit-button" class="button">âœŽ</span>
                <button type="submit" id="save-button" class="button hidden">ðŸ’¾</span>
            </form>
        </td>
        <td>
            <form action="/games/delete" method="POST">
                <input type="hidden" name="game" value="{{.ID}}">
                <button type="submit" style="color: red"> Delete </button>
            </form>
        </td>
    </tr>
    {{end}}
</table>
{{else}}
<p>Currently there are no games.</p>
{{end}}
<a href="games/add">
    <input type="submit" value="+" style="float: right;"></button>
</a>
{{end}}

<script>
    const btn = document.getElementById('edit-button')
    btn.addEventListener('click', function () {
        document.getElementById('input-current-progress').classList.add('active');
        document.getElementById('input-current-progress').classList.remove('hidden');
        document.getElementById('input-final-progress').classList.add('active');
        document.getElementById('input-final-progress').classList.add('hidden');
        document.getElementById('save-button').classList.add('active');
        document.getElementById('save-button').classList.remove('hidden');

        document.getElementById('current-progress').classList.add('hidden');
        document.getElementById('final-progress').classList.add('hidden');
        document.getElementById('edit-button').classList.add('hidden');
    });

    const editStatusButtons = document.getElementsByClassName('edit-status-button')
    for (let i = 0; i < editStatusButtons.length; i++) {
        editStatusButtons[i].addEventListener('click', (e) => {
            const gameId = e.target.dataset.gameId
            document.getElementById(`status-${gameId}`).classList.add('hidden')
            document.getElementById(`edit-status-button-${gameId}`).classList.add('hidden')

            document.getElementById(`save-status-button-${gameId}`).classList.remove('hidden')
            document.getElementById(`status-dropdown-${gameId}`).classList.remove('hidden')
        })
    }
</script>